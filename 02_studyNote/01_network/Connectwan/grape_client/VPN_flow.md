#x86平台VPN

## x86固件烧写  
U盘启动，挂载镜像文件目录到Linux上，将镜像映射到系统盘：  
`dd if=xxx of=xxx`  

## x86网口  
右边两个网口支持DHCP，左边两个网口需要配置同一网段的Ip，使用DHCP配置比较方便  

## x86相关配置  
由于固件是定制版的，openwrt固件已经集成vpn服务，烧写好openwrt以后，直接进行配置即可。  
1. 服务器Ip地址  
2. 负载均衡  
3. 加密方式  
4. 备份Ip  
5. 密码  
6. DNS拦截——防止DNS污染  

## VPN的三大组件  
+ **pdnsd**——dns解析  
+ **ss-redir**——数据转发  
+ **iptables**——IPV4数据包filtering和NAT  

### iptables基本语法  
####规则的观察与清除  

	iptables [-t tables] [-L] [-nv]

选项与参数：  
-t ：后面接 table ，例如 nat 或 filter ，若省略此项目，则使用默认的 filter  
-L ：列出目前的 table 的规则  
-n ：不进行 IP 与 HOSTNAME 的反查，显示讯息的速度会快很多！  
-v ：列出更多的信息，包括通过该规则的封包总位数、相关的网络接口等

	iptables [-t tables] [-FXZ]

选项与参数：  
-F ：清除所有的已订定的规则；  
-X ：杀掉所有使用者 "自定义" 的 chain；  
-Z ：将所有的 chain 的计数与流量统计都归零


####封包的基础比对：IP, 网域及接口装置

    iptables [-AI 链名] [-io 网络接口] [-p 协议] [-s 来源IP/网域] [-d 目标IP/网域] -j [ACCEPT|DROP|REJECT|LOG]  

选项与参数：  
**-AI 链名：针对某的链进行规则的 "插入" 或 "累加"**  
	`-A ：新增加一条规则，该规则增加在原本规则的最后面。例如原本已经有四条规则，使用 -A 就可以加上第五条规则！`  
	`-I ：插入一条规则。如果没有指定此规则的顺序，默认是插入变成第一条规则。`  
	例如原本有四条规则，使用 -I 则该规则变成第一条，而原本四条变成 2~5 号链 ：有 INPUT, OUTPUT, FORWARD 等，此链名称又与 -io 有关，请看底下。

**-io 网络接口：设定封包进出的接口规范**  
	`-i ：封包所进入的那个网络接口，例如 eth0, lo 等接口。需与 INPUT 链配合；`  
	`-o ：封包所传出的那个网络接口，需与 OUTPUT 链配合；`

**-p 协定：设定此规则适用于哪种封包格式**
   主要的封包格式有： tcp, udp, icmp 及 all 。

**-s 来源 IP/网域：设定此规则之封包的来源项目，可指定单纯的 IP 或包括网域，**例如：
   IP  ：192.168.0.100
   网域：192.168.0.0/24, 192.168.0.0/255.255.255.0 均可。
   若规范为『不许』时，则加上 ! 即可，例如：
   -s ! 192.168.100.0/24 表示不许 192.168.100.0/24 之封包来源；

**-d 目标 IP/网域：同 -s ，只不过这里指的是目标的 IP 或网域。**

**-j ：后面接动作，主要的动作有接受(ACCEPT)、丢弃(DROP)、拒绝(REJECT)及记录(LOG)**

### 查询域名服务器Ip工具  
> nslookup www.facebook.com  








